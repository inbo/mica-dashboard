{% extends "dashboard/base.html" %}

{% block extrahead %}
    <style>
        .map {
            height: 640px;
            width: 100%;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col"><h1>Rats data</h1></div>
    </div>

    <div class="row">
        <div class="col">
            <div id="map" class="map"></div>
        </div>
    </div>


    <script type="text/javascript">
        window.onload = function () {
            var vectorSource = new ol.source.Vector({
                loader: function(extent, resolution, projection) {
                    $.ajax({
                        url: {% url 'dashboard-occurrences_csv' %},
                        dataType: "text"
                    }).done(function (data) {
                        var dataArray = data.split('\n');
                        dataArray.forEach(function(row) {
                            var splitted = row.split(',')
                            var id = splitted[0];
                            var lon = splitted[1];
                            var lat = splitted[2];

                            vectorSource.addFeature(new ol.Feature({
                                geometry: new ol.geom.Point([lon, lat]).transform('EPSG:4326', 'EPSG:3857')
                            }));
                        });
                    });
                }
            });

            var vectorLayer = new ol.layer.Vector({
                source: vectorSource
            });

            var map = new ol.Map({
                target: 'map',
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM()
                    }),
                    vectorLayer
                ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([4.67, 50.63]),
                    zoom: 8
                })
            });
        };
    </script>
{% endblock %}